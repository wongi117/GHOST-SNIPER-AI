<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ghost Sniper AI</title>

  <style>
    :root{ --bg:#0b1220; --card:#0f1a33; --muted:#9fb5d9; --ok:#7dffa7; }
    *{ box-sizing:border-box }
    body{ margin:0; background:var(--bg); color:#fff; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif }
    header{ display:flex; gap:12px; align-items:baseline; padding:18px 20px; border-bottom:1px solid #1f2a40 }
    h1{ margin:0; font-size:22px }
    .sub{ color:var(--muted); font-size:13px }
    .wrap{ max-width:1200px; margin:18px auto; padding:0 16px }
    @media (min-width:1000px){
      .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:16px }
    }
    .card{ background:var(--card); border:1px solid #1f2a40; border-radius:10px; padding:16px; margin-bottom:16px }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
    label{ font-size:13px; color:var(--muted) }
    input, select{
      background:#0b1326; border:1px solid #1f2a40; color:#fff;
      padding:10px 12px; border-radius:8px; min-width:0;
    }
    input[readonly]{ opacity:.7 }
    button{
      appearance:none; border:none; border-radius:8px; padding:10px 14px; color:#fff; cursor:pointer;
    }
    button.pri{ background:#2166ff }
    button.sec{ background:#2a3957 }
    button:disabled{ opacity:.55; cursor:not-allowed }
    .ok{ color:var(--ok) }
    .muted{ color:var(--muted) }
    pre{
      background:#0a0f1d; border:1px solid #1f2a40; border-radius:8px;
      padding:10px; margin:0; color:#9cd1ff; overflow:auto; white-space:pre-wrap;
    }
    .badge{ display:inline-block; background:#213a72; border:1px solid #2b4c93; padding:2px 8px; border-radius:999px; font-size:12px }
    hr{ border:none; border-top:1px solid #1f2a40; margin:14px 0 }
    a{ color:#9cd1ff; text-decoration:none } a:hover{ text-decoration:underline }
  </style>
</head>

<body>
  <header>
    <h1>üëª Ghost Sniper</h1>
    <div class="sub">Connect ‚Üí intel ‚Üí quote ‚Üí buy/sell. No keys on server.</div>
  </header>

  <div class="wrap">

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ LEFT/RIGHT GRID ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="grid">

      <!-- LEFT COLUMN -->
      <section class="card">
        <h2>üß† Train from a video link</h2>
        <div class="row">
          <input id="learnUrl" placeholder="Paste YouTube or TikTok URL" style="flex:1" />
          <button id="ingestBtn" class="pri">Analyze</button>
        </div>
        <hr/>
        <pre id="learnOut" class="muted" style="max-height:280px;"></pre>
        <div class="muted" style="margin-top:8px">
          Tip: On iPhone, you can paste shorts/reels URLs too. The server extracts captions/transcripts, summarizes,
          and caches them so you can ask the AI about the video.
        </div>
      </section>

      <!-- RIGHT COLUMN (placeholders you can fill as you go) -->
      <section class="card">
        <h2>‚öôÔ∏è Wallet & Quick Actions</h2>
        <div class="row">
          <button class="sec" id="openPhantom">Open Phantom (iOS helper)</button>
          <button class="pri" id="connectPhantom">Connect Phantom</button>
        </div>
        <div class="row" style="margin-top:10px">
          <label>Address</label>
          <input id="phantomAddr" readonly style="flex:1" placeholder="Not connected" />
        </div>
        <hr/>
        <div class="row">
          <label>Amount (SOL)</label><input id="amt" type="number" step="0.0001" value="0.01" style="width:120px" />
          <label>Slippage %</label><input id="slip" type="number" step="0.1" value="1" style="width:100px" />
          <label>Priority (SOL)</label><input id="fee" type="number" step="0.0001" value="0.0005" style="width:120px" />
        </div>
        <div class="row" style="margin-top:10px">
          <label>Pool</label>
          <select id="pool">
            <option value="pumpfun">Pump.fun</option>
            <option value="raydium">Raydium</option>
            <option value="meteora">Meteora</option>
          </select>
          <button class="pri" id="snipeBtn">Snipe</button>
          <button class="sec" id="sellBtn">Sell</button>
        </div>
        <pre id="txOut" class="muted" style="margin-top:10px;max-height:220px;"></pre>
      </section>

    </div>

    <!-- Live console / logs -->
    <section class="card">
      <h2>üìú Console</h2>
      <pre id="log" style="max-height:260px;"></pre>
    </section>

  </div>

  <!-- Minimal Phantom helper (optional to keep) -->
  <script defer src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>

  <!-- Page scripts -->
  <script>
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Helper: append to console
    const $ = (id)=>document.getElementById(id);
    function logLine(msg){ const el=$('log'); el.textContent += (msg + '\\n'); el.scrollTop = el.scrollHeight; }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Train from link (YouTube/TikTok ‚Üí /api/ingest)
    async function ingestFromLink() {
      const btn = $('ingestBtn');
      const url = $('learnUrl').value.trim();
      const out = $('learnOut');
      if (!url) { out.textContent = "Paste a YouTube or TikTok link."; return; }
      btn.disabled = true; out.textContent = "Fetching & analyzing‚Ä¶";
      try {
        const r = await fetch('/api/ingest', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url })
        });
        const data = await r.json();
        if (!data.ok) {
          out.textContent = "Error: " + (data.error || "unknown");
          logLine("Ingest error: " + JSON.stringify(data));
        } else {
          out.textContent =
            `Provider: ${data.provider}\\nTranscript chars: ${data.chars}\\n\\n` +
            data.analysis;
          logLine("Ingest ok (" + data.provider + "): " + data.chars + " chars");
        }
      } catch (e) {
        out.textContent = "Error: " + e;
        logLine("Ingest exception: " + e);
      } finally {
        btn.disabled = false;
      }
    }
    $('ingestBtn').addEventListener('click', ingestFromLink);

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Phantom quick-connect helpers (non-blocking; optional)
    const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
    if (isIOS) $('openPhantom').style.display = 'inline-block';
    $('openPhantom').onclick = () => {
      // Deep link opens Phantom app where the dApp browser can see window.solana
      location.href = 'https://phantom.app/ul/browse/ghost-sniper-ai-production.up.railway.app';
    };

    $('connectPhantom').onclick = async () => {
      try {
        if (!(window.solana && window.solana.isPhantom)) {
          logLine('Phantom not injected. On iPhone, tap "Open Phantom" and use its browser.');
          alert('Phantom not detected. If you are on iPhone, open this site inside the Phantom app.');
          return;
        }
        const resp = await window.solana.connect();
        $('phantomAddr').value = resp.publicKey.toString();
        logLine('Phantom connected: ' + resp.publicKey.toString());
      } catch (e) {
        logLine('Phantom connect error: ' + e);
        alert('Connect error: ' + e.message);
      }
    };

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Sniping buttons (wire these to your backend routes when ready)
    $('snipeBtn').onclick = async () => {
      $('txOut').textContent = 'Pretend snipe‚Ä¶ (wire to /api/snipe when ready)';
      logLine('Snipe clicked');
    };
    $('sellBtn').onclick = async () => {
      $('txOut').textContent = 'Pretend sell‚Ä¶ (wire to /api/sell when ready)';
      logLine('Sell clicked');
    };
  </script>
</body>
</html>