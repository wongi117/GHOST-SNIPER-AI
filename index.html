<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>ðŸ‘» Ghost Sniper â€” Wallets + Market Intel</title>

  <!-- Minimal inline styles (works without ghost.css) -->
  <style>
    :root{
      --bg:#0b1220; --card:#0f1a33; --line:#1f2a40;
      --muted:#9fb5d9; --text:#e6f0ff; --accent:#7ae582; --accent2:#9c6cff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:15px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--line);position:sticky;top:0;background:linear-gradient(180deg,rgba(11,18,32,.95),rgba(11,18,32,.7))}
    h1{margin:0;font-size:20px}
    .sub{color:var(--muted);font-size:13px}
    .wrap{max-width:1100px;margin:16px auto;padding:0 12px;display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:960px){ .wrap{grid-template-columns:1.1fr .9fr} }
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .col{display:flex;flex-direction:column;gap:8px}
    .muted{color:var(--muted)}
    .badge{display:inline-block;background:#213a5b;border:1px solid var(--line);padding:4px 8px;border-radius:999px;font-size:12px}
    button{appearance:none;border:none;background:#213a5b;border:1px solid var(--line);color:var(--text);padding:10px 12px;border-radius:10px}
    button.sec{background:#2a3957}
    button.ghost{background:transparent;border:1px dashed var(--line)}
    button.primary{background:var(--accent);color:#06220e;font-weight:700}
    button:disabled{opacity:.55;cursor:not-allowed}
    input,select{background:#0b1329;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;min-width:120px}
    label{font-size:12px;color:var(--muted)}
    pre{margin:0;padding:10px;background:#0b1329;border:1px solid var(--line);border-radius:10px;max-height:240px;overflow:auto}
    a{color:#9cd1ff;text-decoration:none}
    a:hover{text-decoration:underline}
    .pill{border-radius:999px;padding:6px 10px;background:#182845;border:1px solid var(--line);display:inline-flex;gap:8px;align-items:center}
    iframe{width:100%;border:0;border-radius:12px;min-height:420px;background:#0b1329}
    .grid2{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:600px){ .grid2{grid-template-columns:1fr 1fr} }
  </style>

  <!-- Solana web3 (for Phantom); tiny helper to detect window.solana -->
  <script defer src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>

  <!-- WalletConnect (MetaMask & other EVM wallets) -->
  <script defer src="https://unpkg.com/@walletconnect/sign-client@2/dist/umd/index.min.js"></script>

  <!-- Dexscreener embed helper (we also call their public API with fetch) -->
  <script>
    const DS_BASE = 'https://api.dexscreener.com/latest/dex';
    async function fetchDexToken(query){
      try{
        const r = await fetch(`${DS_BASE}/search?q=${encodeURIComponent(query)}`);
        const j = await r.json();
        return j; // { pairs: [...] }
      }catch(e){ return { error:String(e) }; }
    }
  </script>

  <!-- CoinGecko public (no key needed) -->
  <script>
    async function geckoSimple(ids='solana',vs='usd'){
      const u = `https://api.coingecko.com/api/v3/simple/price?ids=${encodeURIComponent(ids)}&vs_currencies=${encodeURIComponent(vs)}&include_24hr_change=true`;
      try{
        const r = await fetch(u, { headers: { 'x-cg-demo-api-key':'demo' } }); // header optional
        return await r.json();
      }catch(e){ return { error:String(e) }; }
    }
  </script>
</head>
<body>
  <header>
    <div>
      <h1>ðŸ‘» Ghost Sniper</h1>
      <div class="sub">Live market intel + Wallet connect. You sign â€” no keys on server.</div>
    </div>

    <div class="row">
      <button id="openPhantom" class="ghost" style="display:none">Open in Phantom (iPhone)</button>
      <button id="connectPhantom" class="sec">Connect Phantom</button>
      <span id="phantomAddr" class="badge">Phantom: <span class="muted">disconnected</span></span>
      <button id="connectEvm" class="sec">Connect MetaMask (WalletConnect)</button>
      <span id="evmAddr" class="badge">EVM: <span class="muted">disconnected</span></span>
    </div>
  </header>

  <div class="wrap">
    <!-- LEFT: Market intel, Pump.fun, Dexscreener -->
    <section class="card">
      <h2>Pump.fun + Dexscreener</h2>

      <div class="grid2">
        <div class="col">
          <div class="row">
            <label>Search token / pair (Dexscreener)</label>
            <div class="row">
              <input id="dsQuery" placeholder="e.g. SOL, JUP, token addressâ€¦" />
              <button id="dsSearch">Lookup</button>
            </div>
          </div>
          <pre id="dsOut" class="muted">Waiting for searchâ€¦</pre>
        </div>

        <div class="col">
          <label>Live pair widget</label>
          <!-- Default SOL/USDC on Raydium; user can replace via the textbox below -->
          <iframe id="dsWidget"
            src="https://dexscreener.com/solana?embed=1&theme=dark&trending=true"
            allow="clipboard-read; clipboard-write"
            loading="lazy"></iframe>
          <div class="row">
            <input id="dsPairUrl" placeholder="Paste a Dexscreener pair URL to embedâ€¦" />
            <button id="dsLoad">Load Widget</button>
          </div>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid var(--line);margin:14px 0">

      <div class="grid2">
        <div class="col">
          <h3>CoinGecko Snapshot</h3>
          <div class="row">
            <button id="cgSol" class="sec">Refresh SOL</button>
            <input id="cgId" placeholder="coingecko id (e.g. solana, jupiter-exchange)" />
            <button id="cgFetch">Fetch</button>
          </div>
          <pre id="cgOut" class="muted">SOL price panel will appear hereâ€¦</pre>
        </div>

        <div class="col">
          <h3>Pump.fun (quick links)</h3>
          <div class="row">
            <a class="pill" href="https://pump.fun" target="_blank" rel="noopener">Open pump.fun â†—</a>
            <a class="pill" href="https://www.dextools.io/app/en/solana" target="_blank" rel="noopener">DexTools SOL â†—</a>
            <a class="pill" href="https://jup.ag/swap/USDC-SOL" target="_blank" rel="noopener">Jupiter Swap â†—</a>
          </div>
          <p class="muted" style="margin-top:8px">
            Note: pump.fun blocks iframes; use the link above for full trading UI. We still aggregate price + pair data here via Dexscreener & CoinGecko.
          </p>
        </div>
      </div>
    </section>

    <!-- RIGHT: Sniper controls & activity -->
    <section class="card">
      <h2>Sniper Controls (test mode)</h2>

      <div class="row">
        <div class="col" style="min-width:180px">
          <label>Amount (SOL)</label>
          <input id="amt" type="number" step="0.0001" placeholder="0.1" />
        </div>
        <div class="col" style="min-width:160px">
          <label>Slippage %</label>
          <input id="slip" type="number" step="0.1" placeholder="1.0" />
        </div>
        <div class="col" style="min-width:180px">
          <label>Priority fee (ÂµLamports)</label>
          <input id="fee" type="number" step="1000" placeholder="5000" />
        </div>
        <div class="col" style="min-width:200px">
          <label>Pool</label>
          <select id="pool">
            <option value="raydium">Raydium</option>
            <option value="orca">Orca</option>
            <option value="meteora">Meteora</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <input id="mint" placeholder="Token mint (Solana address)"/>
        <button id="quote" class="sec">Get Quote</button>
        <button id="snipe" class="primary">SNIPE (Simulate)</button>
      </div>

      <pre id="out" style="margin-top:10px">Ready. Connect a wallet, set params, then "Get Quote".</pre>
    </section>
  </div>

  <script>
    // ---------- Helpers ----------
    const $ = (id)=>document.getElementById(id);
    const log = (x)=>{ const p=$('out'); p.textContent = typeof x==='string'?x:JSON.stringify(x,null,2); };

    // ---------- Phantom (Solana) ----------
    const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
    const hasPhantom = ()=>!!(window.phantom && window.phantom.solana);
    const showOpenPhantom = ()=>{ const b=$('openPhantom'); if(isIOS && !hasPhantom()){ b.style.display='inline-block'; } };

    $('openPhantom').onclick = ()=>{
      // Deep-link to open inside Phantomâ€™s in-app browser
      // Replace with your deployed URL
      const url = window.location.href;
      window.location.href = `https://phantom.app/ul/browse/${encodeURIComponent(url)}`;
    };

    let phantomPubkey = null;

    $('connectPhantom').onclick = async ()=>{
      try{
        if(!hasPhantom()){
          alert('Phantom not detected. Install Phantom or open this site inside the Phantom app.');
          showOpenPhantom();
          return;
        }
        const provider = window.phantom.solana;
        const { publicKey } = await provider.connect({ onlyIfTrusted:false });
        phantomPubkey = publicKey?.toString();
        $('phantomAddr').innerHTML = `Phantom: <strong>${phantomPubkey}</strong>`;
        log({ok:true, wallet:'phantom', publicKey: phantomPubkey});
      }catch(e){
        log({error:String(e)});
      }
    };

    // iPhone hint if needed
    showOpenPhantom();

    // ---------- WalletConnect (EVM / MetaMask) ----------
    let wcClient = null, wcTopic = null, evmAddr = null;

    async function initWC(){
      if(wcClient) return wcClient;
      // NOTE: for production you should register a WC projectId. For dev we rely on public bridge defaults.
      wcClient = await window.WalletConnectSignClient.SignClient.init({
        projectId: "b2032e1f9f2c0d6b1-demo", // replace with your WalletConnect projectId when you have one
        metadata: {
          name: "Ghost Sniper",
          description: "Test connect",
          url: window.location.origin,
          icons: ["https://walletconnect.com/walletconnect-logo.png"]
        }
      });
      return wcClient;
    }

    $('connectEvm').onclick = async ()=>{
      try{
        const client = await initWC();
        const { uri, approval } = await client.connect({
          requiredNamespaces:{
            eip155:{
              methods:["eth_sign","personal_sign","eth_sendTransaction"],
              chains:["eip155:1","eip155:8453","eip155:137"],
              events:["accountsChanged","chainChanged"]
            }
          }
        });
        if(uri){
          // open QR modal alternative on mobile: deep-link to MetaMask
          const mm = `metamask://wc?uri=${encodeURIComponent(uri)}`;
          // try to open MetaMask; fallback show alert with uri
          window.location.href = mm;
          alert("If MetaMask didnâ€™t open, copy this WalletConnect URI:\n\n"+uri);
        }
        const session = await approval();
        wcTopic = session.topic;
        const acc = session.namespaces.eip155.accounts[0]; // eip155:chain:address
        evmAddr = acc.split(':')[2];
        $('evmAddr').innerHTML = `EVM: <strong>${evmAddr}</strong>`;
        log({ok:true, wallet:'evm', address:evmAddr, session});
      }catch(e){
        log({error:String(e)});
      }
    };

    // ---------- Dexscreener search + widget ----------
    $('dsSearch').onclick = async ()=>{
      const q = $('dsQuery').value.trim();
      if(!q) return;
      const res = await fetchDexToken(q);
      $('dsOut').textContent = JSON.stringify(res,null,2);
      // If thereâ€™s at least one pair, load its widget
      const p = res?.pairs?.[0];
      if(p?.url){
        $('dsWidget').src = p.url + (p.url.includes('?')?'&':'?') + 'embed=1&theme=dark';
        $('dsPairUrl').value = p.url;
      }
    };
    $('dsLoad').onclick = ()=>{
      const u = $('dsPairUrl').value.trim();
      if(!u) return;
      $('dsWidget').src = u + (u.includes('?')?'&':'?') + 'embed=1&theme=dark';
    };

    // ---------- CoinGecko panel ----------
    async function refreshSOL(){
      const j = await geckoSimple('solana','usd');
      $('cgOut').textContent = JSON.stringify(j,null,2);
    }
    $('cgSol').onclick = refreshSOL;
    $('cgFetch').onclick = async ()=>{
      const id = $('cgId').value.trim() || 'solana';
      const j = await geckoSimple(id,'usd');
      $('cgOut').textContent = JSON.stringify(j,null,2);
    };
    // initial
    refreshSOL();

    // ---------- Sniper (quote simulate placeholder) ----------
    $('quote').onclick = async ()=>{
      const mint = $('mint').value.trim();
      if(!mint) return log('Enter a token mint (Solana address).');
      const amount = Number($('amt').value || 0.1);
      const slippage = Number($('slip').value || 1.0);
      const fee = Number($('fee').value || 5000);
      const pool = $('pool').value;

      // Using Dexscreener as a crude signal: show top pair for the mint
      const search = await fetchDexToken(mint);
      const pair = search?.pairs?.[0];
      log({
        action:'quote',
        pool, mint, amount, slippage, priorityFeeMicrolamports:fee,
        bestPair: pair ? { chain:pair.chainId, dex:pair.dexId, pairAddress:pair.pairAddress, priceUsd:pair.priceUsd } : 'none',
        note:'This is a simulated quote preview; execution requires server-side swap integrations (Jupiter/Orca/Raydium).'
      });
    };

    $('snipe').onclick = ()=>{
      log('ðŸ”« Simulated snipe triggered. Wire up server-side swap route (e.g., /api/snipe via Jupiter) to execute actual trades.');
    };
  </script>
</body>
</html>